{% extends 'principal/base.html' %}
{% load static %}
{% block content %}
<div class="form-container empleado-form-optica" style="max-width: 500px; margin: 0 auto;">
  <h2 class="form-title text-center mb-4">Consultar Diagnósticos</h2>
  <form method="get" class="mb-4">
    <div class="mb-3 d-flex flex-column">
      <label for="cedula" class="form-label mb-1">Buscar por cédula del cliente:</label>
      <input type="text" name="cedula" id="cedula" class="form-control" value="{{ cedula }}" placeholder="Ej: 12345678" maxlength="8">
    </div>
    <div class="mb-3">
      <button type="submit" class="btn btn-optica w-100"><i class="fas fa-search me-2"></i>Buscar</button>
    </div>
  </form>
  {% if cedula %}
    <hr>
    <h3 class="mb-3">Resultados para cédula: {{ cedula }}</h3>
    {% if diagnosticos %}
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead>
            <tr>
              <th>ID Diagnóstico</th>
              <th>Cliente</th>
              <th>Optometrista</th>
              <th>Fecha</th>
              <th>Descripción</th>
            </tr>
          </thead>
          <tbody>
            {% for d in diagnosticos %}
              <tr>
                <td>{{ d.id_diagnostico }}</td>
                <td>{{ d.id_cita.id_cliente.nombre }}</td>
                <td>{{ d.id_cita.id_empleado.nombre }}</td>
                <td>{{ d.fecha }}</td>
                <td>{{ d.descripcion }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="alert alert-info mt-4">No se encontraron diagnósticos para esa cédula.</div>
    {% endif %}
  {% endif %}
  <div class="d-flex justify-content-between align-items-center mt-4">
    <button type="button" class="btn btn-secondary btn-volver" onclick="window.history.back()">
      <i class="fas fa-arrow-left me-2"></i>Volver
    </button>
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const cedulaInput = document.getElementById('cedula');
    cedulaInput.addEventListener('input', function () {
      this.value = this.value.replace(/\D/g, '').slice(0, 8);
    });
  });
</script>
{% endblock %}

{% block extra_head %}
<link href="{% static 'principal/css/gestion.css' %}" rel="stylesheet">
<link href="{% static 'principal/css/optica-estilo.css' %}" rel="stylesheet">
{% endblock %}
